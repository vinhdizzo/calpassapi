---
title: "calpassapi Tutorial"
author: "Vinh Nguyen"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{calpassapi Tutorial}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

The `calpassapi` R package contains functions that help a user query data using CalPASS's [API](https://mmap.calpassplus.org/docs/index.html).

## Install Package
```{r}
# From CRAN (Official)
## install.packages('calpassapi')

# From github (Development)
## devtools::install_github('vinhdizzo/calpassapi')
```

## Load Packages
```{r, message=FALSE, warning=FALSE}
library(calpassapi)
library(dplyr) # Ease in manipulations with data frames
```

## Obtain access token
First we need to authenticate with CalPASS using our credentials in order to obtain a token that will allow us to query data from the API.

```{r, eval=FALSE}
cp_token <- calpass_get_token(username='my_cp_api_uid', password='my_cp_api_pwd')
# cp_token <- calpass_get_token() ## if cp_api_uid and cp_api_pwd are set in .Renviron
```

This token will be used in `calpass_query` and `calpass_query_many` in the `token` argument.

## Create interSegmentKey's for each student
To obtain information for a particular student, we need to convert the student's first name, last name, gender, and birthdate into an `interSegmentKey`, a key that allows the API to look up a student.

```{r}
# single
isk <- calpass_create_isk(first_name='Jane', last_name='Doe'
                 , gender='F', birthdate=20001231)
isk
# multiple
firstname <- c('Tom', 'Jane', 'Jo')
lastname <- c('Ng', 'Doe', 'Smith')
gender <- c('Male', 'Female', 'X')
birthdate <- c(20001231, 19990101, 19981111)
df <- data.frame(firstname, lastname
               , gender, birthdate, stringsAsFactors=FALSE)
df %>%
  mutate(isk=calpass_create_isk(first_name=firstname
                              , last_name=lastname
                              , gender=gender
                              , birthdate
                                ))

```

## Query data from CalPASS
After we have the `interSegmentKey`'s, we can now query data from CalPASS.

```{r, eval=FALSE}
## single
calpass_query(interSegmentKey=isk
            , token=cp_token, endpoint='transcript')
## multiple
dfResults <- calpass_query(interSegmentKey=df$isk
                         , token=cp_token
                         , endpoint='transcript'
                           )
```
